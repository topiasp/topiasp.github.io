(this.webpackJsonppysakki=this.webpackJsonppysakki||[]).push([[0],{195:function(e,t,r){e.exports=r(335)},335:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(29),c=r.n(o),i=r(20),l=r(40),u=r(119),s=r(41),p=r(349),f=r(352),m=r(350),d=r(353),b=r(82),O=r.n(b),g=function(e){var t=e.SETUP,r=e.mapDiv,n=e.elementsToMap;return a.a.createElement(p.a,{center:t.MAPCONFIG.CENTER,zoom:t.MAPCONFIG.ZOOM,ref:r,doubleClickZoom:!0,className:"map__reactleaflet"},a.a.createElement(f.a,{url:t.MAPLAYER.URL}),n.map((function(e){return a.a.createElement(m.a,{key:O()(),color:e.color,weight:e.weight,positions:e.positions},a.a.createElement(d.a,null,e.popup()))})))},y=r(343),h=function(){var e=Object(n.createRef)(),t={MAPCONFIG:{CENTER:[65.029219,25.465416],ZOOM:16,CRS:4326,BUFFERSIZE:2e3},MAPLAYER:{URL:"https://cdn.digitransit.fi/map/v1/hsl-map-256/{z}/{x}/{y}.png"}};return a.a.createElement(y.a,null,"Nonsense",a.a.createElement(g,{elementsToMap:[],SETUP:t,mapDiv:e}))},E=r(38),v=r.n(E),j=r(56),P=function(){var e=Object(j.a)(v.a.mark((function e(t){var r,n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("params",t),r=['["',t.map((function(e){return e.stopId})).join('","'),'"]'].join(""),n="{ stops(ids: "+r+")",n+="{   name gtfsId  stoptimesWithoutPatterns(numberOfDepartures:10) {",n+=["scheduledArrival","realtimeArrival","arrivalDelay","scheduledDeparture","realtimeDeparture","departureDelay","realtime","realtimeState","serviceDay","headsign"].join(" "),n+=" trip {     gtfsId        tripShortName        serviceId  pattern { code }      route {          id          shortName          gtfsId        }              }",n+="   }       }      }",e.next=10,fetch("https://api.digitransit.fi/routing/v1/routers/hsl/index/graphql",{body:JSON.stringify({query:n}),headers:{"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"},method:"POST",mode:"cors",redirect:"follow",referrer:"no-referrer"});case 10:return a=e.sent,e.abrupt("return",a);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(r,!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var I=function(e){return function(){var t=Object(j.a)(v.a.mark((function t(r){var n,a,o;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P(e);case 2:return n=t.sent,t.next=5,n.json();case 5:return a=t.sent,o=a.data.stops.flatMap((function(e){return e.stoptimesWithoutPatterns.map((function(t){return w({stopname:e.name,stopId:e.gtfsId},t)}))})),t.abrupt("return",r({type:"SET_TIMETABLES",data:o}));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},D=r(346),T=r(42),N=r(113),k=r.n(N),A=function(e){var t=(e-e%60)/60,r=(t-t%60)/60;return r<10&&(r="0"+r),(t%=60)<10&&(t="0"+t),r+":"+t};function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var R=Object(l.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(r,!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e)}),{getTimetables:I})((function(e){var t=e.followedPatterns,r=e.getTimetables,o=e.timetables;if(Object(n.useEffect)((function(){t&&t.length>0&&r(t)}),[t]),!o)return"";return a.a.createElement(y.a,null,a.a.createElement(D.a.Group,null,o.filter((function(e){return t.find((function(t){return t.patternId===e.trip.pattern.code}))})).map((function(e){var t=e.trip.route.shortName,r=A(e.realtimeArrival),n=A(e.scheduledArrival);return a.a.createElement(D.a,{key:k()(),fluid:!0},a.a.createElement(D.a.Content,{style:{fontSize:"120%"}},a.a.createElement("span",{style:{color:"#006600",fontSize:"150%"}},t," "),a.a.createElement(T.a,{name:"beer",style:{float:"right",fontSize:"150%",color:"#eaea4e"}})),a.a.createElement(D.a.Content,null,a.a.createElement("span",null,a.a.createElement("b",null," ",r," ")),a.a.createElement("span",{style:{marginLeft:"5%"}},n)))}))))})),x=r(64),C=r(180),z=r.n(C),L=function(){var e=Object(j.a)(v.a.mark((function e(t){var r,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r='{\n      stops(name: "'.concat(t,'") {\n        gtfsId\n        name\n        code\n        lat\n        lon\n        patterns {\n          code\n          directionId\n          headsign\n          route {\n            gtfsId\n            shortName\n            longName\n            mode\n          }\n        }\n      }\n    }\n    '),e.next=3,fetch("https://api.digitransit.fi/routing/v1/routers/hsl/index/graphql",{body:JSON.stringify({query:r}),headers:{"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"},method:"POST",mode:"cors",redirect:"follow",referrer:"no-referrer"});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=r(347),F=function(e){var t=e.patterns.map((function(e){return"(".concat(e.headsign," ").concat(e.route.shortName,")")}));return{title:e.name+" "+t,key:e.gtfsId,name:e.name,patterns:e.patterns}},U=function(e){var t=e.setSelectedStop,r=Object(n.useState)([]),o=Object(x.a)(r,2),c=o[0],i=o[1],l=Object(n.useState)(""),u=Object(x.a)(l,2),s=u[0],p=u[1];return a.a.createElement(y.a,null,a.a.createElement(_.a,{minCharacters:4,noResultsMessage:"Pys\xe4kkej\xe4 ei l\xf6ydy",onResultSelect:function(e,r){var n=r.result;t(n),console.log("selected",n)},onSearchChange:z.a.debounce((function(e,t){var r=t.value;p(r),L(r).then((function(e){return e.json()})).then((function(e){console.log("res",e),i(e.data.stops.map((function(e){return F(e)})))}))}),500,{leading:!0}),results:c,value:s,size:"big"}))},q=r(351),B=r(345),G=r(348),J="bustop-followed-patterns",Z=function(){var e=localStorage.getItem(J);return(void 0===e|null===e?[]:e.split(",")).map((function(e){return{stopId:e.split("|")[0],patternId:e.split("|")[1]}}))},W=function(e){var t=localStorage.getItem(J);void 0===t|null===t?localStorage.setItem(J,e):localStorage.setItem(J,t.split(",").concat(e))},Y=[];function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var H=Object(l.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(r,!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e)}),{addPattern:function(e){return W(e.stop.key+"|"+e.pattern.code),{type:"ADD_PATTERN",data:e}}})((function(e){var t=e.addPattern,r=e.followedPatterns,o=Object(n.useState)(void 0),c=Object(x.a)(o,2),i=c[0],l=c[1],u=Object(s.f)();return a.a.createElement(y.a,null,i?a.a.createElement("div",null,a.a.createElement(q.a,{as:"h2"},i.name),a.a.createElement(B.a,{divided:!0,verticalAlign:"middle"},i.patterns.map((function(e){var n="RAIL"===e.route.mode?"train":e.route.mode.toLowerCase();return r.find((function(t){return t.pattern.code===e.code}))?"":a.a.createElement(B.a.Item,{key:O()()},a.a.createElement(B.a.Content,{floated:"right"},a.a.createElement(G.a,{positive:!0,onClick:function(){return t({stop:i,pattern:e})}},a.a.createElement(T.a,{name:n,style:{fontSize:"150%",color:"white"}}),"Seuraa")),a.a.createElement(B.a.Content,null,a.a.createElement("span",{style:{marginRight:"2%"}},"Suunta: ",e.headsign),a.a.createElement("span",{style:{fontSize:"150%"}},e.route.shortName)))})))):a.a.createElement(U,{setSelectedStop:l}),a.a.createElement(G.a,{positive:!0,onClick:function(){u.push("/")}},"Valmista"))}));function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var Q=Object(l.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(r,!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e)}),{getTimetables:I,setPatterns:function(e){return{type:"SET_PATTERNS",data:e}}})((function(e){var t=e.setPatterns;Object(n.useEffect)((function(){t(Z().filter((function(e){return e.patternId})))}),[]);var r=Z();return a.a.createElement(u.a,null,a.a.createElement(s.b,{exact:!0,path:"/",render:function(){return r.length>0?a.a.createElement(R,null):a.a.createElement(s.a,{to:"/choose"})}}),a.a.createElement(s.b,{exact:!0,path:"/map",render:function(){return a.a.createElement(h,null)}}),a.a.createElement(s.b,{exact:!0,path:"/choose",render:function(){return a.a.createElement(H,null)}}))})),X=r(48),$=r(185),ee=r(186),te=Object(X.combineReducers)({timetables:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TIMETABLES":return t.data;case"INIT":return null;default:return e}},followedPatterns:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_PATTERN":return e.concat(t.data);case"SET_PATTERNS":return t.data;case"INIT":return Y;default:return e}}}),re=Object(X.createStore)(te,Object(ee.composeWithDevTools)(Object(X.applyMiddleware)($.a)));c.a.render(a.a.createElement(l.a,{store:re},a.a.createElement(Q,null)),document.getElementById("root"))}},[[195,1,2]]]);
//# sourceMappingURL=main.f94f4020.chunk.js.map