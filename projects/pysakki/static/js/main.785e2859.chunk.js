(this.webpackJsonppysakki=this.webpackJsonppysakki||[]).push([[0],{173:function(e,t,r){e.exports=r(312)},312:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(24),c=r.n(o),i=r(16),s=r(29),u=r(27),l=r.n(u),p=r(42),f=function(){var e=Object(p.a)(l.a.mark((function e(t){var r,n,a,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("params",t),r=t.reduce((function(e,t){return e.includes(t.stopId)?e:e.concat(t.stopId)}),[]),n=['["',r.join('","'),'"]'].join(""),a="{ stops(ids: "+n+")",a+="{   name gtfsId  stoptimesWithoutPatterns(numberOfDepartures:15) {",a+=["scheduledArrival","realtimeArrival","arrivalDelay","scheduledDeparture","realtimeDeparture","departureDelay","realtime","realtimeState","serviceDay","headsign"].join(" "),a+=" trip {     gtfsId        tripShortName        serviceId  pattern { code }      route {          id          shortName          gtfsId        }              }",a+="   }       }      }",e.next=11,fetch("https://api.digitransit.fi/routing/v1/routers/hsl/index/graphql",{body:JSON.stringify({query:a}),headers:{"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"},method:"POST",mode:"cors",redirect:"follow",referrer:"no-referrer"});case 11:return o=e.sent,e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(r,!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var b=function(e){return function(){var t=Object(p.a)(l.a.mark((function t(r){var n,a,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f(e);case 2:return n=t.sent,t.next=5,n.json();case 5:return a=t.sent,console.log("parsedStream",a),(o=a.data.stops.flatMap((function(e){return e.stoptimesWithoutPatterns.map((function(t){return m({stopname:e.name,stopId:e.gtfsId},t)}))}))).sort((function(e,t){return e.realtimeArrival-t.realtimeArrival})),t.abrupt("return",r({type:"SET_TIMETABLES",data:o}));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},O=r(319),y=r(322),g=r(30),h=r(94),v=r.n(h),j=function(e){var t=(e-e%60)/60,r=(t-t%60)/60;return r<10&&(r="0"+r),(t%=60)<10&&(t="0"+t),r+":"+t};function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var P=Object(s.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(r,!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e)}),{getTimetables:b})((function(e){var t=e.followedPatterns,r=e.getTimetables,o=e.timetables;if(Object(n.useEffect)((function(){t&&t.length>0&&r(t)}),[t]),!o)return"";return a.a.createElement(O.a,null,a.a.createElement(y.a.Group,null,o.filter((function(e){return t.find((function(t){return t.patternId===e.trip.pattern.code}))})).map((function(e){var t=e.trip.route.shortName,r=j(e.realtimeArrival),n=j(e.scheduledArrival);return a.a.createElement(y.a,{key:v()(),fluid:!0},a.a.createElement(y.a.Content,{style:{fontSize:"120%"}},a.a.createElement("span",{style:{color:"#006600",fontSize:"150%"}},t," "),a.a.createElement(g.a,{name:"beer",style:{float:"right",fontSize:"150%",color:"#eaea4e"}})),a.a.createElement(y.a.Content,null,a.a.createElement("span",null,a.a.createElement("b",null," ",r," ")),a.a.createElement("span",{style:{marginLeft:"5%"}},n)))}))))})),S=r(44),w=r(158),I=r.n(w),D=function(){var e=Object(p.a)(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r='{\n      stops(name: "'.concat(t,'") {\n        gtfsId\n        name\n        code\n        lat\n        lon\n        patterns {\n          code\n          directionId\n          headsign\n          route {\n            gtfsId\n            shortName\n            longName\n            mode\n          }\n        }\n      }\n    }\n    '),e.next=3,fetch("https://api.digitransit.fi/routing/v1/routers/hsl/index/graphql",{body:JSON.stringify({query:r}),headers:{"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"},method:"POST",mode:"cors",redirect:"follow",referrer:"no-referrer"});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=r(323),k=function(e){var t=e.patterns.map((function(e){return"(".concat(e.headsign," ").concat(e.route.shortName,")")}));return{title:e.name+" "+t,key:e.gtfsId,name:e.name,patterns:e.patterns}},N=function(e){var t=e.setSelectedStop,r=Object(n.useState)([]),o=Object(S.a)(r,2),c=o[0],i=o[1],s=Object(n.useState)(""),u=Object(S.a)(s,2),l=u[0],p=u[1];return a.a.createElement(O.a,null,a.a.createElement(T.a,{minCharacters:4,noResultsMessage:"Pys\xe4kkej\xe4 ei l\xf6ydy",onResultSelect:function(e,r){var n=r.result;t(n),console.log("selected",n)},onSearchChange:I.a.debounce((function(e,t){var r=t.value;p(r),D(r).then((function(e){return e.json()})).then((function(e){console.log("res",e),i(e.data.stops.map((function(e){return k(e)})))}))}),500,{leading:!0}),results:c,value:l,size:"big"}))},A=r(325),x=r(321),C=r(324),M=r(162),R=r.n(M),z="bustop-followed-patterns",_=function(e){var t=localStorage.getItem(z);void 0===t|null===t?localStorage.setItem(z,e):localStorage.setItem(z,t.split(",").concat(e))},L=[],q=function(e){return{stopId:e.stop.key,patternId:e.pattern.code}},J=function(e){return e.stop.key+"|"+e.pattern.code};function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var W=Object(s.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(r,!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e)}),{addPatterns:function(e){return e.forEach((function(e){return _(J(e))})),{type:"SET_PATTERNS",data:e.map(q)}}})((function(e){var t=e.addPatterns,r=e.followedPatterns,o=Object(n.useState)(void 0),c=Object(S.a)(o,2),i=c[0],s=c[1],u=Object(n.useState)([]),l=Object(S.a)(u,2),p=l[0],f=l[1];return console.log("selectedPatterns",p),a.a.createElement(O.a,null,i?a.a.createElement("div",null,a.a.createElement(A.a,{as:"h2"},i.name),a.a.createElement(x.a,{divided:!0,verticalAlign:"middle"},i.patterns.map((function(e){var t="RAIL"===e.route.mode?"train":e.route.mode.toLowerCase();return r.find((function(t){return t.patternId===e.code}))||p.find((function(t){return t.pattern.code===e.code}))?"":a.a.createElement(x.a.Item,{key:R()()},a.a.createElement(x.a.Content,{floated:"right"},a.a.createElement(C.a,{positive:!0,onClick:function(){return f(p.concat({stop:i,pattern:e}))}},a.a.createElement(g.a,{name:t,style:{fontSize:"150%",color:"white"}}),"Seuraa")),a.a.createElement(x.a.Content,null,a.a.createElement("span",{style:{marginRight:"2%"}},"Suunta: ",e.headsign),a.a.createElement("span",{style:{fontSize:"150%"}},e.route.shortName)))})))):a.a.createElement(N,{setSelectedStop:s}),a.a.createElement(C.a,{positive:!0,onClick:function(){return t(p)}},"Valmista"))}));function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var V=Object(s.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(r,!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e)}),{getTimetables:b,setPatterns:function(e){return{type:"SET_PATTERNS",data:e}}})((function(e){var t=e.setPatterns,r=e.followedPatterns;return Object(n.useEffect)((function(){t(function(){var e=localStorage.getItem(z);return(void 0===e|null===e?[]:e.split(",")).map((function(e){return{stopId:e.split("|")[0],patternId:e.split("|")[1]}}))}().filter((function(e){return e.patternId})))}),[]),a.a.createElement(O.a,null,r.length>0?a.a.createElement(P,null):a.a.createElement(W,null))})),F=r(35),H=r(163),K=r(164),Q=Object(F.combineReducers)({timetables:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TIMETABLES":return t.data;case"INIT":return null;default:return e}},followedPatterns:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_PATTERN":return e.concat(t.data);case"SET_PATTERNS":return t.data;case"INIT":return L;default:return e}}}),U=Object(F.createStore)(Q,Object(K.composeWithDevTools)(Object(F.applyMiddleware)(H.a)));c.a.render(a.a.createElement(s.a,{store:U},a.a.createElement(V,null)),document.getElementById("root"))}},[[173,1,2]]]);
//# sourceMappingURL=main.785e2859.chunk.js.map