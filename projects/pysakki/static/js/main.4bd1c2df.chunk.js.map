{"version":3,"sources":["services/timetables.js","reducers/timetableReducer.js","utils/UnixTime.js","components/Departures.js","services/stops.js","components/Search.js","utils/LocalStorage.js","reducers/followedPatternsReducer.js","components/ChooseBus.js","App.js","store.js","index.js"],"names":["getTimetables","params","a","console","log","uniqueStopIds","reduce","t","c","includes","stopId","concat","stops","join","query","fetch","body","JSON","stringify","headers","method","mode","redirect","referrer","timetables","dispatch","getTimetablesService","data","json","parsedStream","manipulatedData","flatMap","stop","stoptimesWithoutPatterns","map","departure","stopname","name","gtfsId","sort","tripA","tripB","realtimeArrival","type","unixTimeToHoursAndMinutes","fullMinutes","hours","connect","state","followedPatterns","useEffect","length","Container","Card","Group","filter","find","followed","patternId","trip","pattern","code","header","route","shortName","realTime","scheduled","scheduledArrival","key","uuidv4","fluid","Content","style","fontSize","color","Icon","float","marginLeft","searchStops","searchString","extractInfoForDisplay","bussesAndDirections","patterns","pat","headsign","title","Search","setSelectedStop","useState","results","setResults","value","setValue","minCharacters","noResultsMessage","onResultSelect","e","result","onSearchChange","_","debounce","then","res","s","leading","size","localStorageId","getLocalStoragePatterns","storageContent","localStorage","getItem","undefined","split","addToLocalStoragePatterns","patternid","setItem","initialstate","addPattern","selectedStop","history","useHistory","Header","as","List","divided","verticalAlign","icon","toLowerCase","p","Item","uuid","floated","Button","positive","onClick","marginRight","push","setPatterns","localStoragePatterns","reducer","combineReducers","action","store","createStore","composeWithDevTools","applyMiddleware","thunk","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.4bd1c2df.chunk.js","sourcesContent":["\r\n\r\n\r\nexport const getTimetables = async (params) => {\r\n\r\n    console.log('params', params)\r\n    //var con = '[' + '\"'+ params[0].stop.key +'\"' +']' ||'[\"HSL:1293123\"]' \r\n\r\n    const uniqueStopIds = params.reduce((t,c) => t.includes(c.stopId) ? t : t.concat(c.stopId)  , [])\r\n\r\n    //const stops = ['[\"',params.map(t => t.stopId).join('\",\"'),'\"]'].join('')\r\n    const stops = ['[\"', uniqueStopIds.join('\",\"'),'\"]'].join('')\r\n   \r\n    // Form query\r\n    let query = '{ stops(ids: '+stops+')'\r\n    \r\n    \r\n\r\n    query += '{   name gtfsId  stoptimesWithoutPatterns(numberOfDepartures:15) {'\r\n\r\n    let paramsForApi = [\r\n    'scheduledArrival',\r\n    'realtimeArrival',\r\n    'arrivalDelay',\r\n    'scheduledDeparture',\r\n    'realtimeDeparture',\r\n    'departureDelay',\r\n    'realtime',\r\n    'realtimeState',\r\n    'serviceDay',\r\n    'headsign']\r\n\r\n    query += paramsForApi.join(' ');\r\n    // TODO: terrible\r\n    query += ' trip {     gtfsId        tripShortName        serviceId  pattern { code }      route {          id          shortName          gtfsId        }              }'\r\n    query += '   }       }      }';\r\n    \r\n\r\n    // Post it\r\n\r\n    const timetables = await fetch('https://api.digitransit.fi/routing/v1/routers/hsl/index/graphql', {\r\n            body: JSON.stringify({ query }),\r\n            headers: {\r\n            'user-agent': 'Mozilla/4.0 MDN Example',\r\n            'content-type': 'application/json'\r\n            },\r\n            method: 'POST', \r\n            mode: 'cors', \r\n            redirect: 'follow', \r\n            referrer: 'no-referrer', \r\n        })\r\n\r\n    return timetables//.then(res => res.json)\r\n\r\n\r\n} \r\n\r\n\r\n\r\n","import { getTimetables as getTimetablesService } from '../services/timetables'\r\n\r\n\r\nconst initialstate = null\r\n\r\n\r\n\r\n\r\nexport const timetableReducer = (state = initialstate, action) => {\r\n\r\n  switch (action.type) {\r\n  case 'SET_TIMETABLES':\r\n    return action.data\r\n\r\n  case 'INIT':\r\n    return initialstate\r\n  \r\n  default:\r\n    return state\r\n  }\r\n}\r\n\r\nexport const initData = () => {\r\n  return {\r\n    type: 'INIT',\r\n    data: undefined\r\n  }\r\n}\r\n\r\n\r\nexport const getTimetables = (params) => {\r\n\r\n   \r\n\r\n    \r\n    return async dispatch => {\r\n      \r\n      const data =      await getTimetablesService(params)  \r\n\r\n      const parsedStream = await data.json()\r\n      \r\n      console.log('parsedStream',parsedStream)\r\n      const manipulatedData = parsedStream.data.stops.flatMap(stop =>  stop.stoptimesWithoutPatterns.map(departure =>   ({ stopname: stop.name, stopId: stop.gtfsId, ...departure })        ) )\r\n      \r\n      manipulatedData.sort((tripA,tripB) => tripA.realtimeArrival - tripB.realtimeArrival)\r\n      //console.log('resp', manipulatedData)\r\n  \r\n      return dispatch({\r\n        type: 'SET_TIMETABLES',\r\n        data: manipulatedData\r\n      })\r\n     \r\n    }\r\n}","const unixTimeToHoursAndMinutes = (t) => {\r\n\r\n    // t = seconds from midnight\r\n\r\n    let fullMinutes = (t - (t % 60)) / 60\r\n    let hours =  (fullMinutes - (fullMinutes % 60)) / 60\r\n    fullMinutes = ((fullMinutes % 60) )\r\n    \r\n\r\n    if (hours<10) {\r\n        hours = '0'+hours\r\n    }\r\n    if (fullMinutes<10) {\r\n        fullMinutes = '0'+fullMinutes\r\n    }\r\n\r\n    return hours +\":\"+fullMinutes\r\n}\r\n\r\nexport default  unixTimeToHoursAndMinutes","\r\nimport React, { useEffect } from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { Container, Card, Icon } from 'semantic-ui-react'\r\n\r\nimport  uuidv4  from 'uuid/v4'\r\nimport unixTimeToHoursAndMinutes from '../utils/UnixTime'\r\nimport { getTimetables } from '../reducers/timetableReducer'\r\n\r\n\r\nconst Departures = ({ followedPatterns, getTimetables, timetables }) => {\r\n\r\n  \r\n    useEffect(() => {\r\n\r\n        if (followedPatterns && followedPatterns.length>0 ) {\r\n            getTimetables( followedPatterns )\r\n        }\r\n            \r\n\r\n    },[followedPatterns])\r\n    \r\n    \r\n    if (!timetables) {\r\n        return('')\r\n    }\r\n    const isDepartureFollowed = departure =>       followedPatterns.find(followed => followed.patternId === departure.trip.pattern.code)\r\n    \r\n\r\n    return(\r\n        <Container>\r\n\r\n            <Card.Group>\r\n            {\r\n                timetables.filter(isDepartureFollowed).map(departure => {\r\n                    let header = departure.trip.route.shortName\r\n\r\n                    let realTime = unixTimeToHoursAndMinutes( departure.realtimeArrival )\r\n                    let scheduled = unixTimeToHoursAndMinutes( departure.scheduledArrival) \r\n                    \r\n                    const headerStyle = { fontSize: '120%' }\r\n\r\n\r\n                    return(\r\n                        <Card\r\n                            key = { uuidv4() }\r\n                            fluid\r\n                        >\r\n                            <Card.Content style={headerStyle}>\r\n                                <span style={{color: '#006600', fontSize: '150%'}}>{ header } </span>\r\n                                <Icon name=\"beer\" style={{float: 'right', fontSize: '150%', color: '#eaea4e' }}></Icon>\r\n                            </Card.Content>\r\n                            <Card.Content>\r\n                            <span><b> { realTime } </b></span>\r\n                            <span style={{marginLeft:'5%'}}>{ scheduled }</span>\r\n                            \r\n                            </Card.Content>\r\n                            \r\n                            \r\n                        </Card>\r\n                    )\r\n\r\n                })\r\n            }\r\n            </Card.Group>\r\n        </Container>\r\n    )\r\n}\r\n\r\nconst mapStateToProps = (state) =>  ({ ...state })\r\nexport default connect(mapStateToProps, {   getTimetables })(Departures)","\r\n\r\n\r\nconst searchStops = async (searchString) => {\r\n\r\n    \r\n    //const searchString = 'hertto'//params.searchString\r\n   \r\n    // Form query\r\n    //let query = '{ stops(ids: '+params.searchString+')'\r\n    \r\n    \r\n\r\n    //query += '{   name gtfsId  stoptimesWithoutPatterns(numberOfDepartures:10) {'\r\n\r\n   \r\n\r\n    const query = `{\r\n      stops(name: \"${searchString}\") {\r\n        gtfsId\r\n        name\r\n        code\r\n        lat\r\n        lon\r\n        patterns {\r\n          code\r\n          directionId\r\n          headsign\r\n          route {\r\n            gtfsId\r\n            shortName\r\n            longName\r\n            mode\r\n          }\r\n        }\r\n      }\r\n    }\r\n    `\r\n    // Post it\r\n\r\n    const stops = await fetch('https://api.digitransit.fi/routing/v1/routers/hsl/index/graphql', {\r\n            body: JSON.stringify({ query }),\r\n            headers: {\r\n            'user-agent': 'Mozilla/4.0 MDN Example',\r\n            'content-type': 'application/json'\r\n            },\r\n            method: 'POST', \r\n            mode: 'cors', \r\n            redirect: 'follow', \r\n            referrer: 'no-referrer', \r\n        })\r\n\r\n    return stops//.then(res => res.json)\r\n\r\n\r\n} \r\n\r\n\r\n\r\nexport default searchStops ","import React, { useState, useEffect } from 'react'\r\nimport _ from 'lodash'\r\nimport searchStops from '../services/stops'\r\nimport { Search as SemanticSearch, Container } from 'semantic-ui-react'\r\n\r\nconst Search = ({ setSelectedStop }) => {\r\n\r\n    const [results,setResults] = useState([])\r\n    const [value,setValue] = useState('')\r\n\r\n    \r\n\r\n    const handleSearchChange = (e, { value }) => {\r\n        \r\n\r\n        setValue(value)\r\n\r\n        searchStops(value).then(res => res.json()).then(res => {\r\n            console.log('res',res)\r\n            setResults(res.data.stops.map(s => extractInfoForDisplay(s)  ))\r\n        })\r\n \r\n    }\r\n\r\n    const handleResultSelect = (e, { result }) => {\r\n         setSelectedStop(result)\r\n         console.log('selected', result)\r\n    }\r\n\r\n\r\n\r\n    return(\r\n        \r\n        <Container>\r\n            <SemanticSearch\r\n                minCharacters={4}\r\n                noResultsMessage='Pysäkkejä ei löydy'\r\n                onResultSelect={ handleResultSelect}\r\n                onSearchChange={ _.debounce( handleSearchChange , 500, {\r\n                    leading: true,\r\n                })}\r\n                results={results}\r\n                value={value}\r\n                size='big'\r\n                \r\n            />\r\n        </Container>   \r\n        \r\n    )\r\n}\r\n\r\n\r\nvar extractInfoForDisplay = stop => {\r\n\r\n    const bussesAndDirections = stop.patterns.map(pat =>  `(${ pat.headsign } ${pat.route.shortName})` )\r\n\r\n    return {\r\n        title: stop.name + ' ' + bussesAndDirections\r\n        ,key: stop.gtfsId\r\n        ,name: stop.name\r\n        ,patterns: stop.patterns\r\n    }\r\n\r\n}\r\n\r\n\r\nexport default Search","const localStorageId = 'bustop-followed-patterns'\r\n\r\nexport const getLocalStoragePatterns = () => {\r\n    const storageContent = localStorage.getItem(localStorageId)\r\n\r\n    const patterns = storageContent === undefined | storageContent === null ? [] : storageContent.split(',')\r\n\r\n    return patterns.map(pattern => ( { stopId: pattern.split('|')[0], patternId: pattern.split('|')[1] } ))\r\n\r\n}\r\n\r\n\r\nexport const includedLocalStoragePatterns = patternid => {\r\n    const storageContent = localStorage.getItem(localStorageId)\r\n\r\n    return storageContent === undefined | storageContent === null ? false : ( storageContent.split(',').find(c => c === patternid) !== undefined )\r\n\r\n}\r\n\r\nexport const addToLocalStoragePatterns = patternid => {\r\n    const storageContent = localStorage.getItem(localStorageId)\r\n    if ( storageContent === undefined | storageContent === null ) {\r\n        localStorage.setItem(localStorageId,patternid)\r\n    } else {\r\n        localStorage.setItem(localStorageId,  storageContent.split(',').concat(patternid))\r\n    } \r\n}\r\n\r\n\r\nexport const removeFromLocalStoragePatterns = patternid => {\r\n    const storageContent = localStorage.getItem(localStorageId)\r\n    if ( storageContent === undefined | storageContent === null ) {\r\n        return undefined\r\n    } else {\r\n        localStorage.setItem(localStorageId,  storageContent.split(',').filter( c => c !== patternid  )  )\r\n    } \r\n}\r\n\r\nexport const toggleLocalStoragePatterns = patternid => {\r\n\r\n    if ( includedLocalStoragePatterns(patternid) ) {\r\n        removeFromLocalStoragePatterns(patternid)\r\n    } else {\r\n        addToLocalStoragePatterns(patternid)\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { addToLocalStoragePatterns } from '../utils/LocalStorage'\r\n\r\nconst initialstate = []\r\n\r\n\r\n\r\nexport const followedPatternsReducer = (state = initialstate, action) => {\r\n\r\n  switch (action.type) {\r\n  case 'ADD_PATTERN':\r\n    return state.concat(action.data)\r\n  case 'SET_PATTERNS':\r\n    return action.data\r\n\r\n  case 'INIT':\r\n    return initialstate\r\n    \r\n  \r\n  default:\r\n    return state\r\n  }\r\n}\r\n\r\nexport const setPatterns = patterns => {\r\n\r\n  return {\r\n    type: 'SET_PATTERNS',\r\n    data: patterns\r\n  }\r\n\r\n}\r\n\r\n\r\nexport const addPattern = pattern => {\r\n\r\n\r\n  // Handle local storage\r\n  addToLocalStoragePatterns(  pattern.stop.key + '|' + pattern.pattern.code )\r\n\r\n  return {\r\n    type: 'ADD_PATTERN',\r\n    data: pattern\r\n  }\r\n}","import React, { useState } from 'react'\r\nimport Search from './Search'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { List, Button, Container, Icon, Header } from 'semantic-ui-react'\r\nimport uuid from 'uuid'\r\nimport { addPattern } from '../reducers/followedPatternsReducer'\r\n\r\n\r\nimport {\r\n    useHistory \r\n  } from 'react-router-dom'\r\n\r\n\r\nconst ChooseBus = ({ addPattern, followedPatterns }) => {\r\n\r\n    const [selectedStop,setSelectedStop] = useState(undefined)\r\n\r\n    let history = useHistory();\r\n\r\n    function handleReady() {\r\n      history.push(\"/\");\r\n    }\r\n    \r\n\r\n    return(\r\n        <Container>\r\n            {\r\n                selectedStop ?\r\n                    <div>\r\n                        <Header as='h2'>{ selectedStop.name }</Header>\r\n\r\n                        <List divided verticalAlign='middle'>\r\n                                {\r\n                                    selectedStop.patterns.map(pattern => {\r\n\r\n                                        const icon = pattern.route.mode === 'RAIL' ? 'train' : pattern.route.mode.toLowerCase()\r\n\r\n                                        // Dont add if already followed\r\n                                        if (followedPatterns.find(p => p.pattern.code === pattern.code)) {\r\n                                            return('')\r\n                                        }\r\n\r\n                                        return(\r\n                                            <List.Item key={ uuid() }>\r\n                                                <List.Content floated='right'>\r\n                                                    <Button\r\n                                                        positive\r\n                                                        onClick={ () => addPattern({ stop: selectedStop, pattern }) }\r\n                                                    >\r\n                                                        <Icon name={icon} style={{ fontSize: '150%', color: 'white' }}></Icon>\r\n                                                        Seuraa\r\n                                                    </Button>\r\n                                                </List.Content>\r\n                                                <List.Content>\r\n                                                    <span style={{ marginRight: '2%' }}>Suunta: { pattern.headsign }</span>\r\n                                                    <span style={{ fontSize: '150%'}}>{pattern.route.shortName}</span>\r\n                                                    \r\n                                                </List.Content>\r\n                                            </List.Item>\r\n                                        )\r\n                                    })\r\n                                }\r\n                            </List>\r\n                        </div>\r\n                    :\r\n                    <Search setSelectedStop={setSelectedStop} />\r\n            }\r\n            <Button positive onClick={ handleReady } >Valmista</Button>\r\n            \r\n\r\n        </Container>\r\n    )\r\n}\r\n\r\n\r\n\r\nconst mapStateToProps = (state) =>  ({ ...state })\r\nexport default connect(mapStateToProps, {   addPattern })(ChooseBus)","import React, { useEffect } from 'react'\nimport { connect } from 'react-redux'\n\n\nimport { getTimetables }  from './reducers/timetableReducer'\nimport Departures     from './components/Departures'\nimport ChooseBus from './components/ChooseBus'\nimport { getLocalStoragePatterns } from './utils/LocalStorage'\nimport { setPatterns } from './reducers/followedPatternsReducer'\nimport { Container } from 'semantic-ui-react'\n\nconst App = ({ setPatterns }) => {\n\n\n  useEffect(() => {\n    // Import from local storage\n    setPatterns(getLocalStoragePatterns().filter(s => s.patternId))  \n\n  },[])\n\n\n  const localStoragePatterns = getLocalStoragePatterns()\n\n  return(\n\n    <Container>\n       {\n          localStoragePatterns.length > 0 ? \n            <Departures/>\n            :\n            <ChooseBus />\n      \n        } \n    </Container>\n\n  )\n\n}\n\n\n\n\nconst mapStateToProps = (state) =>  ({ ...state })\nexport default connect(mapStateToProps, {   getTimetables, setPatterns })(App)","import { createStore, combineReducers, applyMiddleware } from 'redux'\r\nimport thunk from 'redux-thunk'\r\n\r\nimport { composeWithDevTools } from 'redux-devtools-extension'\r\n\r\nimport { timetableReducer } from './reducers/timetableReducer'\r\nimport { followedPatternsReducer } from './reducers/followedPatternsReducer'\r\n\r\n\r\nconst reducer = combineReducers({\r\n  timetables: timetableReducer,\r\n  followedPatterns: followedPatternsReducer\r\n})\r\n\r\nconst store = createStore(reducer,composeWithDevTools(applyMiddleware(thunk)))\r\n\r\nexport default store","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\n\nimport { Provider } from 'react-redux'\n\nimport store from './store'\n\n\nReactDOM.render(\n    <Provider store={store}>\n      <App />\n    </Provider>, document.getElementById('root'))\n"],"sourceRoot":""}